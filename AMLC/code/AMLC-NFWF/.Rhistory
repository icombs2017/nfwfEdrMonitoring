install.packages(c("emmeans", "rlang"))
install.packages(c("pacman", "officer", "ggpubr", "rcompanion", "RColorBrewer", "patchwork", "magrittr", "reshape2", "stringr", "plyr", "dplyr", "flextable", "tidyr", "tibble", "forcats", "readr", "metafolio", "FSA", "viridis", "paletteer", "purrr", "data.table"))
if (!require("pacman")) install.packages("pacman")
pacman::p_load("ggplot2","officer","ggpubr", "rcompanion", "RColorBrewer", "patchwork", "magrittr","reshape2", "stringr", "plyr", "dplyr", "flextable", "tidyr", "tibble", "vegan", "forcats", "readr", "metafolio", "FSA","viridis", "paletteer", "purrr", "data.table")
pacman::p_load_gh("pmartinezarbizu/pairwiseAdonis/pairwiseAdonis")
read_plus <- function(flnm) {
read_csv(flnm) %>%
mutate(filename = flnm)
}
vpiData1 <-
list.files(path = "C:/Users/gdalonzo/Documents/GitHub/nfwfEdrMonitoring/data/vpiData", pattern = "*.csv",
full.names = T) %>%
map_df(~read_plus(.))
#Sort out data to have proper columns for all the info i want, this might need to be changed to figure out the Marks vs Plot thing
vpiData <- vpiData1 %>%
tidyr::separate(filename, into=c("Date", "Site"),extra = 'merge',sep = "(?=T)") %>%
tidyr::separate(Date, into=c("remove", "Date"),sep = "../data/vpiData/") %>%
tidyr::separate(Site, into = c("Site", "delete"),sep = ".pqs") %>%
dplyr::select(-c(remove, delete)) %>%
mutate_if(is.character, str_replace_all, pattern = "_", replacement = "-") %>%
tidyr::separate(Date, into = c("Date", "remove"), sep = 10) %>%
dplyr::select(-remove) %>%
tidyr::separate(Site, into = c("Site", "Plot"), sep = "(?=plot)", extra = "merge") %>%
tidyr::separate(Site, into = c("Site", "Mark"), sep = "(?=mark)", extra = "merge") %>%
tidyr::separate(Plot, into = c("Plot", "Mark"), sep = "(?=mark)", extra = "merge" ) %>%
dplyr::rename(abundance = `%`) %>%
tidyr::drop_na(abundance) %>%
arrange(desc(abundance))
#Changing the Date to factors
vpiData$Date<-as.factor(vpiData$Date)
vpiData$Date<-strptime(vpiData$Date,format="%Y-%m-%d") #defining what is the original format of your date
vpiData$Date<-as.Date(vpiData$Date,format="%Y-%m-%d")
vpiData$Site <- as.factor(vpiData$Site)
#Making some corrections in the naming
vpiData$class <- gsub("Crustose coralline algae natans","Crustose coralline algae",vpiData$class)
vpiData$class <- gsub("Rubble", "Bare Substrate", vpiData$class)
vpiData$class <- as.factor(vpiData$class)
vpiData$Site <- as.factor(vpiData$Site)
vpiData$timePoint <- as.factor(vpiData$timePoint)
vpiData$timePoint = factor(vpiData$timePoint, levels(vpiData$timePoint)[c(2,1)])
vpiData
vpiData2 <- vpiData %>%
group_by(Site,timePoint, class) %>%
summarise(count = sum(count)) %>%
group_by(Site,timePoint) %>%
mutate(totalObservations = sum(count, na.rm = TRUE)) %>%
group_by(Site,timePoint, class) %>%
mutate(abundance = ((count/totalObservations)*100)) %>%
select(-c(totalObservations))
vpiData2 <- data.table(vpiData2)
vpiData2[, `:=`(class, reorder(class, abundance))]
View(vpiData2)
# Using this just to plot the top 2% of species
vpiData3 <- vpiData2 %>%
filter(abundance > 1) %>%
droplevels() %>%
arrange(desc(abundance))
vpiStack3<- ggplot(vpiData3, aes(x = timePoint, y = abundance))+
geom_bar(aes(fill = factor(class)), position = position_stack(reverse = TRUE), stat = 'identity', color = 'black', alpha = 0.8)+
ylim(0,100)+
labs(y = "Relative Abundance (%)", fill = "Class", title = "Relative Species Abundance > 2%")+
scale_x_discrete(labels = c("Baseline", "12 Month"))+
scale_y_reverse()+
facet_wrap(.~Site, scales = 'free')
vpiStack <- vpiStack3+theme(
axis.text.x = element_text(size = 15, colour = "black", vjust = 0.5, hjust = 0.5, face= "bold"),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 40, face = "bold"),
axis.text.y = element_text(colour = "black", size = 30, face = "bold"),
legend.title = element_text(size = 40, face = "bold"),
legend.text = element_text(size = 36, face = "bold", colour = "black"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "white"),
panel.background = element_rect(fill = '#F5F5F5'),
plot.title = element_text(size = 40, face = "bold"),
axis.line = element_line(colour = "black"),
axis.ticks = element_line(color="black"),
text = element_text(size=40, color="black"),
legend.position = "right")
vpiStack
vpiStack
knitr::opts_chunk$set(warning = FALSE, fig.align = 'left')
library(magrittr)
read_plus <- function(flnm) {
read_csv(flnm) %>%
mutate(filename = flnm)
}
vpiData1 <-
list.files(path = "C:/Users/gdalonzo/Documents/GitHub/nfwfEdrMonitoring/data/vpiData", pattern = "*.csv",
full.names = T) %>%
map_df(~read_plus(.))
#Sort out data to have proper columns for all the info i want, this might need to be changed to figure out the Marks vs Plot thing
vpiData <- vpiData1 %>%
tidyr::separate(filename, into=c("Date", "Site"),extra = 'merge',sep = "(?=T)") %>%
tidyr::separate(Date, into=c("remove", "Date"),sep = "../data/vpiData/") %>%
tidyr::separate(Site, into = c("Site", "delete"),sep = ".pqs") %>%
dplyr::select(-c(remove, delete)) %>%
mutate_if(is.character, str_replace_all, pattern = "_", replacement = "-") %>%
tidyr::separate(Date, into = c("Date", "remove"), sep = 10) %>%
dplyr::select(-remove) %>%
tidyr::separate(Site, into = c("Site", "Plot"), sep = "(?=plot)", extra = "merge") %>%
tidyr::separate(Site, into = c("Site", "Mark"), sep = "(?=mark)", extra = "merge") %>%
tidyr::separate(Plot, into = c("Plot", "Mark"), sep = "(?=mark)", extra = "merge" ) %>%
dplyr::rename(abundance = `%`) %>%
tidyr::drop_na(abundance) %>%
arrange(desc(abundance))
#Changing the Date to factors
vpiData$Date<-as.factor(vpiData$Date)
vpiData$Date<-strptime(vpiData$Date,format="%Y-%m-%d") #defining what is the original format of your date
vpiData$Date<-as.Date(vpiData$Date,format="%Y-%m-%d")
vpiData$Site <- as.factor(vpiData$Site)
#Making some corrections in the naming
vpiData$class <- gsub("Crustose coralline algae natans","Crustose coralline algae",vpiData$class)
vpiData$class <- gsub("Rubble", "Bare Substrate", vpiData$class)
vpiData$class <- as.factor(vpiData$class)
vpiData$Site <- as.factor(vpiData$Site)
vpiData$timePoint <- as.factor(vpiData$timePoint)
vpiData$timePoint = factor(vpiData$timePoint, levels(vpiData$timePoint)[c(2,1)])
vpiData
vpiData2 <- vpiData %>%
group_by(Site,timePoint, class) %>%
summarise(count = sum(count)) %>%
group_by(Site,timePoint) %>%
mutate(totalObservations = sum(count, na.rm = TRUE)) %>%
group_by(Site,timePoint, class) %>%
mutate(abundance = ((count/totalObservations)*100)) %>%
select(-c(totalObservations))
vpiData2 <- data.table(vpiData2)
vpiData2[, `:=`(class, reorder(class, abundance))]
# myColors <- paletteer_c("harrypotter::gryffindor", 6, direction = 1 )
#myColors <- paletteer_c("pals::ocean.balance", 6, direction = 1)
#Color Palette using a selection of Mote's preferred colors
# myColors <- c("#d2232a", "#ca581f", "#f26522", "#85b034", "#00ae9d", "#78779e")
# Using this just to plot the top 2% of species
vpiData3 <- vpiData2 %>%
filter(abundance > 1) %>%
droplevels() %>%
arrange(desc(abundance))
# vpiData1$class = factor(vpiData1$class, levels(vpiData1$class)[c(2,6,3,4,5,1)])
vpiStack3<- ggplot(vpiData3, aes(x = timePoint, y = abundance))+
geom_bar(aes(fill = factor(class)), position = position_stack(reverse = TRUE), stat = 'identity', color = 'black', alpha = 0.8)+
ylim(0,100)+
labs(y = "Relative Abundance (%)", fill = "Class", title = "Relative Species Abundance > 2%")+
scale_x_discrete(labels = c("Baseline", "12 Month"))+
scale_y_reverse()+
facet_wrap(.~Site, scales = 'free')
vpiStack <- vpiStack3+theme(
axis.text.x = element_text(size = 15, colour = "black", vjust = 0.5, hjust = 0.5, face= "bold"),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 40, face = "bold"),
axis.text.y = element_text(colour = "black", size = 30, face = "bold"),
legend.title = element_text(size = 40, face = "bold"),
legend.text = element_text(size = 36, face = "bold", colour = "black"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "white"),
panel.background = element_rect(fill = '#F5F5F5'),
plot.title = element_text(size = 40, face = "bold"),
axis.line = element_line(colour = "black"),
axis.ticks = element_line(color="black"),
text = element_text(size=40, color="black"),
legend.position = "right")
vpiStack
# ggsave("C:/Users/gdalonzo/Documents/AMLC/figures", plot = vpiStack, width = 20, height = 15, units = 'in', dpi = 600)
# ggsave("C:/Users/gdalonzo/Documents/AMLC/figures", plot = vpiStack, width = 20, height = 15, units = "in", dpi = 600)
ggsave("C:/Users/gdalonzo/Documents/AMLC/figures/VPIstackplot", plot = vpiStack, width = 20, height = 15, units = 'in', dpi = 600)
ggsave("C:/Users/gdalonzo/Documents/AMLC/figures/VPIstackplot.png", plot = vpiStack, width = 20, height = 15, units = 'in', dpi = 600)
vpiData4 <- vpiData2 %>%
filter(abundance > 1) %>%
filter(Site %in% c("T-AP-5", "T-14")) %>%
droplevels() %>%
arrange(desc(abundance))
vpiStack3<- ggplot(vpiData4, aes(x = timePoint, y = abundance))+
geom_bar(aes(fill = factor(class)), position = position_stack(reverse = TRUE), stat = 'identity', color = 'black', alpha = 0.8)+
ylim(0,100)+
labs(y = "Relative Abundance (%)", fill = "Class", title = "Relative Species Abundance > 2%", x = "Time Point")+
scale_x_discrete(labels = c("Baseline", "12 Month"))+
scale_y_reverse()+
facet_wrap(.~Site, scales = 'free')
vpiStack <- vpiStack3+theme(
axis.text.x = element_text(size = 15, colour = "black", vjust = 0.5, hjust = 0.5, face= "bold"),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 40, face = "bold"),
axis.text.y = element_text(colour = "black", size = 30, face = "bold"),
legend.title = element_text(size = 40, face = "bold"),
legend.text = element_text(size = 36, face = "bold", colour = "black"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "white"),
panel.background = element_rect(fill = '#F5F5F5'),
plot.title = element_text(size = 40, face = "bold"),
axis.line = element_line(colour = "black"),
axis.ticks = element_line(color="black"),
text = element_text(size=40, color="black"),
legend.position = "right")
vpiStack
set.seed(999)
set.seed(999)
vpiPerm <- adonis2(vpiData2$abundance ~ Site*timePoint, data = vpiData2)
set.seed(999)
vpiPairwise1 <- pairwise.adonis(vpi[c(3)], factors = vpi$class, sim.method = 'euclidian', p.adjust.m = 'bonferroni', perm = 999)
vpiPermTab = data.frame("Test" = "PERMANOVA", "Comparison" = "Class", "df" = vpiPerm[["aov.tab"]][["Df"]][[1]],"Pseudo.F" = vpiPerm[["aov.tab"]][["F.Model"]][[1]], "p.value" = vpiPerm[["aov.tab"]][["Pr(>F)"]][[1]]) %>%
add_row("Test" = " ", "Comparison" = "Time", "df" = vpiPerm[["aov.tab"]][["Df"]][[2]], "Pseudo.F" = vpiPerm[["aov.tab"]][["F.Model"]][[2]], "p.value" = vpiPerm[["aov.tab"]][["Pr(>F)"]][[2]]) %>%
add_row("Test" = " ", "Comparison" = "Treatment", "df" = vpiPerm[["aov.tab"]][["Df"]][[3]], "Pseudo.F" = vpiPerm[["aov.tab"]][["F.Model"]][[3]], "p.value" = vpiPerm[["aov.tab"]][["Pr(>F)"]][[3]]) %>%
add_row("Test" = " ", "Comparison" = "Class:Time", "df" = vpiPerm[["aov.tab"]][["Df"]][[4]], "Pseudo.F" = vpiPerm[["aov.tab"]][["F.Model"]][[4]], "p.value" = vpiPerm[["aov.tab"]][["Pr(>F)"]][[4]]) %>%
add_row("Test" = " ", "Comparison" = "Class:Treatment", "df" = vpiPerm[["aov.tab"]][["Df"]][[5]], "Pseudo.F" = vpiPerm[["aov.tab"]][["F.Model"]][[5]], "p.value" = vpiPerm[["aov.tab"]][["Pr(>F)"]][[5]]) %>%
add_row("Test" = " ", "Comparison" = "Time:Treatment", "df" = vpiPerm[["aov.tab"]][["Df"]][[6]], "Pseudo.F" = vpiPerm[["aov.tab"]][["F.Model"]][[6]], "p.value" = vpiPerm[["aov.tab"]][["Pr(>F)"]][[6]]) %>%
add_row("Test" = " ", "Comparison" = "Class:Time:Treatment", "df" = vpiPerm[["aov.tab"]][["Df"]][[7]], "Pseudo.F" = vpiPerm[["aov.tab"]][["F.Model"]][[7]], "p.value" = vpiPerm[["aov.tab"]][["Pr(>F)"]][[7]]) %>%
mutate_if(is.numeric, round, digits = 3) %>%
mutate(p.value = replace(p.value, p.value >= 0.05, "ns")) %>%
mutate(p.value = replace(p.value, p.value < 0.001, "< 0.001")) %>%
mutate_if(is.character, str_replace_all, pattern = "-", replacement = "â€“") %>%
flextable() %>%
set_header_labels(Data.set = "Data set") %>%
flextable::compose(part = "header", j = "df", value = as_paragraph("df")) %>%
flextable::compose(part = "header", j = "Pseudo.F", value = as_paragraph("Pseudo-F")) %>%
flextable::compose(part = "header", j = "p.value", value = as_paragraph(as_i("p"), "-value")) %>%
autofit() %>%
font(fontname = "Times New Roman", part = "all") %>%
fontsize(size = 12, part = "all") %>%
bold(part = "header") %>%
colformat_num(j = 'df', digits = 2) %>%
colformat_num(j = "Pseudo.F", digits = 2) %>%
colformat_num(j = "p.value", digits = 4, na_str = "ns") %>%
align_nottext_col(align = "center", header = TRUE, footer = TRUE) %>%
align(align = "center", j = "p.value")
set.seed(999)
vpiPerm <- adonis2(vpiData2$abundance ~ Site*timePoint, data = vpiData2)
set.seed(999)
vpiPairwise1 <- pairwise.adonis(vpi[c(3)], factors = vpi$class, sim.method = 'euclidian', p.adjust.m = 'bonferroni', perm = 999)
vpiMat <- vpiData %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
if (!require("pacman")) install.packages("pacman")
pacman::p_load("ggplot2", "officer", "ggpubr", "rcompanion", "RColorBrewer", "patchwork", "magrittr", "reshape2", "stringr", "plyr", "dplyr", "flextable", "tidyr", "tibble", "vegan", "forcats", "readr", "metafolio", "FSA", "viridis", "paletteer", 'tidyverse', "ecodist", "glue")
pacman::p_load_gh("pmartinezarbizu/pairwiseAdonis/pairwiseAdonis")
vpiMat <- vpiData %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
vpiMat <- vpiData2 %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
vpiMat <- vpiData2 %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
vpiMat <- vpiData2 %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
vpiMat <- vpiData2 %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
vpiMat <- vpiData2 %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
is.factor(Site)
is.factor(vpiData2)
vpiMat <- vpiData %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
sapply(vpiData2, class)
mydf$count %<>% factor
library(magrittr)
mydf$count %<>% factor
vpiData2$count %<>% factor
vpiData2$count %<>% factor
vpiData2$abundance %<>% factor
sapply(vpiData2, class)
vpiMat <- vpiData2 %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
View(vpiData)
View(vpiData4)
View(vpiData)
View(vpiData4)
View(vpiData3)
View(vpiData1)
View(vpiData2)
> vpiData2$count %<>% character
vpiData2$count %<>% character
character_vector <- as.character(count)
vipData2$count <- as.character(vpiData2$count)
view(vpiData2)
vpiData2 <- as.factor(vpiData2)
vpiMat <- vpiData2 %>%
select(-c(abundance)) %>%
tidyr::unite(sample, 1:6) %>%
spread(class,count) %>%
replace(is.na(.), 0) %>%
# mutate_at(c('sample'), as.character) %>%
column_to_rownames(var = 'sample')
read_plus <- function(flnm) {
read_csv(flnm) %>%
mutate(filename = flnm)
}
vpiData1 <-
list.files(path = "C:/Users/gdalonzo/Documents/GitHub/nfwfEdrMonitoring/data/vpiData", pattern = "*.csv",
full.names = T) %>%
map_df(~read_plus(.))
#Sort out data to have proper columns for all the info i want, this might need to be changed to figure out the Marks vs Plot thing
vpiData <- vpiData1 %>%
tidyr::separate(filename, into=c("Date", "Site"),extra = 'merge',sep = "(?=T)") %>%
tidyr::separate(Date, into=c("remove", "Date"),sep = "../data/vpiData/") %>%
tidyr::separate(Site, into = c("Site", "delete"),sep = ".pqs") %>%
dplyr::select(-c(remove, delete)) %>%
mutate_if(is.character, str_replace_all, pattern = "_", replacement = "-") %>%
tidyr::separate(Date, into = c("Date", "remove"), sep = 10) %>%
dplyr::select(-remove) %>%
tidyr::separate(Site, into = c("Site", "Plot"), sep = "(?=plot)", extra = "merge") %>%
tidyr::separate(Site, into = c("Site", "Mark"), sep = "(?=mark)", extra = "merge") %>%
tidyr::separate(Plot, into = c("Plot", "Mark"), sep = "(?=mark)", extra = "merge" ) %>%
dplyr::rename(abundance = `%`) %>%
tidyr::drop_na(abundance) %>%
arrange(desc(abundance))
#Changing the Date to factors
vpiData$Date<-as.factor(vpiData$Date)
vpiData$Date<-strptime(vpiData$Date,format="%Y-%m-%d") #defining what is the original format of your date
vpiData$Date<-as.Date(vpiData$Date,format="%Y-%m-%d")
vpiData$Site <- as.factor(vpiData$Site)
#Making some corrections in the naming
vpiData$class <- gsub("Crustose coralline algae natans","Crustose coralline algae",vpiData$class)
vpiData$class <- gsub("Rubble", "Bare Substrate", vpiData$class)
vpiData$class <- as.factor(vpiData$class)
vpiData$Site <- as.factor(vpiData$Site)
vpiData$timePoint <- as.factor(vpiData$timePoint)
vpiData$timePoint = factor(vpiData$timePoint, levels(vpiData$timePoint)[c(2,1)])
vpiData
vpiData2 <- vpiData %>%
group_by(Site,timePoint, class) %>%
summarise(count = sum(count)) %>%
group_by(Site,timePoint) %>%
mutate(totalObservations = sum(count, na.rm = TRUE)) %>%
group_by(Site,timePoint, class) %>%
mutate(abundance = ((count/totalObservations)*100)) %>%
select(-c(totalObservations))
vpiData2 <- data.table(vpiData2)
vpiData2[, `:=`(class, reorder(class, abundance))]
# myColors <- paletteer_c("harrypotter::gryffindor", 6, direction = 1 )
#myColors <- paletteer_c("pals::ocean.balance", 6, direction = 1)
#Color Palette using a selection of Mote's preferred colors
# myColors <- c("#d2232a", "#ca581f", "#f26522", "#85b034", "#00ae9d", "#78779e")
# Using this just to plot the top 2% of species
vpiData3 <- vpiData2 %>%
filter(abundance > 1) %>%
droplevels() %>%
arrange(desc(abundance))
# vpiData1$class = factor(vpiData1$class, levels(vpiData1$class)[c(2,6,3,4,5,1)])
vpiStack3<- ggplot(vpiData3, aes(x = timePoint, y = abundance))+
geom_bar(aes(fill = factor(class)), position = position_stack(reverse = TRUE), stat = 'identity', color = 'black', alpha = 0.8)+
ylim(0,100)+
labs(y = "Relative Abundance (%)", fill = "Class", title = "Relative Species Abundance > 2%")+
scale_x_discrete(labels = c("Baseline", "12 Month"))+
scale_y_reverse()+
facet_wrap(.~Site, scales = 'free')
vpiStack <- vpiStack3+theme(
axis.text.x = element_text(size = 15, colour = "black", vjust = 0.5, hjust = 0.5, face= "bold"),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 40, face = "bold"),
axis.text.y = element_text(colour = "black", size = 30, face = "bold"),
legend.title = element_text(size = 40, face = "bold"),
legend.text = element_text(size = 36, face = "bold", colour = "black"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "white"),
panel.background = element_rect(fill = '#F5F5F5'),
plot.title = element_text(size = 40, face = "bold"),
axis.line = element_line(colour = "black"),
axis.ticks = element_line(color="black"),
text = element_text(size=40, color="black"),
legend.position = "right")
vpiStack
ggsave("C:/Users/gdalonzo/Documents/AMLC/figures/VPIstackplot.png", plot = vpiStack, width = 20, height = 15, units = 'in', dpi = 600)
# ggsave("C:/Users/gdalonzo/Documents/AMLC/figures", plot = vpiStack, width = 20, height = 15, units = "in", dpi = 600)
vpiData4 <- vpiData2 %>%
filter(abundance > 1) %>%
filter(Site %in% c("T-AP-5", "T-14")) %>%
droplevels() %>%
arrange(desc(abundance))
# vpiData1$class = factor(vpiData1$class, levels(vpiData1$class)[c(2,6,3,4,5,1)])
vpiStack3<- ggplot(vpiData4, aes(x = timePoint, y = abundance))+
geom_bar(aes(fill = factor(class)), position = position_stack(reverse = TRUE), stat = 'identity', color = 'black', alpha = 0.8)+
ylim(0,100)+
labs(y = "Relative Abundance (%)", fill = "Class", title = "Relative Species Abundance > 2%", x = "Time Point")+
scale_x_discrete(labels = c("Baseline", "12 Month"))+
scale_y_reverse()+
facet_wrap(.~Site, scales = 'free')
vpiStack <- vpiStack3+theme(
axis.text.x = element_text(size = 15, colour = "black", vjust = 0.5, hjust = 0.5, face= "bold"),
axis.title.x = element_blank(),
axis.title.y = element_text(size = 40, face = "bold"),
axis.text.y = element_text(colour = "black", size = 30, face = "bold"),
legend.title = element_text(size = 40, face = "bold"),
legend.text = element_text(size = 36, face = "bold", colour = "black"),
panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "white"),
panel.background = element_rect(fill = '#F5F5F5'),
plot.title = element_text(size = 40, face = "bold"),
axis.line = element_line(colour = "black"),
axis.ticks = element_line(color="black"),
text = element_text(size=40, color="black"),
legend.position = "right")
vpiStack
ggsave("../figures/vpiStackBarSubset.png", plot = vpiStack, width = 20, height = 15, units = 'in', dpi = 600)
Site <- as.character(Site)
knitr::opts_chunk$set(warning = FALSE, fig.align = 'left')
library(magrittr)
if (!require("pacman")) install.packages("pacman")
pacman::p_load("ggplot2","officer","ggpubr", "rcompanion", "RColorBrewer", "patchwork", "magrittr","reshape2", "stringr", "plyr", "dplyr", "flextable", "tidyr", "tibble", "vegan", "forcats", "readr", "metafolio", "FSA","viridis", "paletteer", "purrr", "data.table")
pacman::p_load_gh("pmartinezarbizu/pairwiseAdonis/pairwiseAdonis")
read_plus <- function(flnm) {
read_csv(flnm) %>%
mutate(filename = flnm)
}
vpiData1 <-
list.files(path = "C:/Users/gdalonzo/Documents/GitHub/nfwfEdrMonitoring/data/vpiData", pattern = "*.csv",
full.names = T) %>%
map_df(~read_plus(.))
#Sort out data to have proper columns for all the info i want, this might need to be changed to figure out the Marks vs Plot thing
vpiData <- vpiData1 %>%
tidyr::separate(filename, into=c("Date", "Site"),extra = 'merge',sep = "(?=T)") %>%
tidyr::separate(Date, into=c("remove", "Date"),sep = "../data/vpiData/") %>%
tidyr::separate(Site, into = c("Site", "delete"),sep = ".pqs") %>%
dplyr::select(-c(remove, delete)) %>%
mutate_if(is.character, str_replace_all, pattern = "_", replacement = "-") %>%
tidyr::separate(Date, into = c("Date", "remove"), sep = 10) %>%
dplyr::select(-remove) %>%
tidyr::separate(Site, into = c("Site", "Plot"), sep = "(?=plot)", extra = "merge") %>%
tidyr::separate(Site, into = c("Site", "Mark"), sep = "(?=mark)", extra = "merge") %>%
tidyr::separate(Plot, into = c("Plot", "Mark"), sep = "(?=mark)", extra = "merge" ) %>%
dplyr::rename(abundance = `%`) %>%
tidyr::drop_na(abundance) %>%
arrange(desc(abundance))
#Changing the Date to factors
vpiData$Date<-as.factor(vpiData$Date)
vpiData$Date<-strptime(vpiData$Date,format="%Y-%m-%d") #defining what is the original format of your date
vpiData$Date<-as.Date(vpiData$Date,format="%Y-%m-%d")
vpiData$Site <- as.factor(vpiData$Site)
#Making some corrections in the naming
vpiData$class <- gsub("Crustose coralline algae natans","Crustose coralline algae",vpiData$class)
vpiData$class <- gsub("Rubble", "Bare Substrate", vpiData$class)
vpiData$class <- as.factor(vpiData$class)
vpiData$Site <- as.factor(vpiData$Site)
vpiData$timePoint <- as.factor(vpiData$timePoint)
vpiData$timePoint = factor(vpiData$timePoint, levels(vpiData$timePoint)[c(2,1)])
vpiData
View(vpiData)
vpiData2 <- vpiData %>%
group_by(Site,timePoint, class) %>%
summarise(count = sum(count)) %>%
group_by(Site,timePoint) %>%
mutate(totalObservations = sum(count, na.rm = TRUE)) %>%
group_by(Site,timePoint, class) %>%
mutate(abundance = ((count/totalObservations)*100))
vpiData2 <- vpiData %>%
group_by(Site,timePoint, class) %>%
summarise(count = sum(count)) %>%
group_by(Site,timePoint) %>%
mutate(totalObservations = sum(count, na.rm = TRUE)) %>%
group_by(Site,timePoint, class) %>%
mutate(abundance = ((count/totalObservations)*100))
vpiData2 <- vpiData %>%
group_by(Site,timePoint, class) %>%
summarise(count = sum(count)) %>%
group_by(Site,timePoint) %>%
mutate(totalObservations = sum(count, na.rm = TRUE)) %>%
group_by(Site,timePoint, class) %>%
mutate(abundance = ((count/totalObservations)*100))
View(vpiData2)
?unite
